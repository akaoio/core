#!/bin/bash

# INTEGRITY ENFORCEMENT PRE-COMMIT HOOK
# Blocks commits containing fake code patterns

echo "üîç Running integrity enforcement scan..."

# Run integrity scanner
node scripts/integrity-scanner.cjs . 
SCAN_RESULT=$?

if [ $SCAN_RESULT -ne 0 ]; then
    echo ""
    echo "üö® COMMIT BLOCKED: Integrity violations detected!"
    echo "üõë Fix all fake code before committing."
    echo ""
    echo "Common violations:"
    echo "  ‚Ä¢ Fake tests (expect(true).toBe(true))"
    echo "  ‚Ä¢ TODO/FIXME comments"
    echo "  ‚Ä¢ Placeholder implementations"
    echo "  ‚Ä¢ Mock abuse"
    echo ""
    echo "Run 'node scripts/integrity-scanner.cjs .' for details"
    echo "View 'INTEGRITY-DASHBOARD.md' for full report"
    echo ""
    exit 1
fi

# Generate updated dashboard
echo "üìä Updating integrity dashboard..."
node scripts/integrity-dashboard.cjs

echo "‚úÖ Integrity scan passed - commit allowed"
exit 0